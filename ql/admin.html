<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V35 ADMIN ‚Äì SYSTEM MANAGER</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<style>
    body { 
        background-color: #050505;
        background-image: radial-gradient(ellipse at 50% 0%, #1a1b26 0%, #050505 60%);
        color: #e5e7eb; 
        font-family: 'Plus Jakarta Sans', sans-serif;
    }
    .glass { 
        background: rgba(20, 20, 25, 0.7); 
        border: 1px solid rgba(255, 255, 255, 0.08); 
        backdrop-filter: blur(24px); 
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }
    .card-section {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
    }
    .card-section:hover {
        background: rgba(255, 255, 255, 0.04);
        border-color: rgba(255, 255, 255, 0.1);
    }
    .pro-input { 
        background: rgba(0, 0, 0, 0.3); 
        border: 1px solid rgba(255, 255, 255, 0.1); 
        color: #fff;
        transition: all 0.2s;
    }
    .pro-input:focus { 
        outline: none; 
        border-color: #8b5cf6; 
        background: rgba(139, 92, 246, 0.1); 
        box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.1);
    }
    select.pro-input option { background: #141419; color: #fff; padding: 10px; }
    
    @keyframes highlight {
        0% { background-color: rgba(139, 92, 246, 0.5); transform: scale(1.02); }
        100% { background-color: rgba(0, 0, 0, 0.3); transform: scale(1); }
    }
    .new-code { animation: highlight 1s ease-out; }
    
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
</style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

<!-- M·ªü r·ªông chi·ªÅu r·ªông container ƒë·ªÉ ch·ª©a 2 c·ªôt -->
<div class="w-full max-w-6xl rounded-3xl glass relative overflow-hidden">
    
    <!-- Background Glow -->
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-64 h-32 bg-violet-600/20 blur-[80px] rounded-full pointer-events-none"></div>

    <div class="p-6 md:p-8 relative z-10">

        <!-- LOGIN SCREEN -->
        <div id="loginBox" class="max-w-sm mx-auto space-y-8 py-10">
            <div class="text-center space-y-2">
                <div class="w-16 h-16 bg-gradient-to-tr from-violet-600 to-blue-600 rounded-2xl mx-auto flex items-center justify-center shadow-lg shadow-violet-500/30 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                    </svg>
                </div>
                <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">ADMIN CONTROL</h1>
                <p class="text-sm text-gray-500">H·ªá th·ªëng qu·∫£n l√Ω V35</p>
            </div>
            
            <div class="space-y-4">
                <input id="adminPass" type="password" placeholder="M·∫≠t kh·∫©u admin"
                    class="pro-input w-full px-4 py-3.5 rounded-xl text-center font-mono placeholder-gray-600 text-lg tracking-widest">
                
                <button onclick="adminLogin()"
                    class="w-full py-3.5 bg-gradient-to-r from-violet-600 to-blue-600 hover:from-violet-500 hover:to-blue-500 rounded-xl font-bold text-white transition-all active:scale-[0.98] shadow-lg shadow-violet-900/20">
                    ƒêƒÇNG NH·∫¨P
                </button>
                <p id="loginStatus" class="text-center text-xs text-red-400 font-medium min-h-[20px]"></p>
            </div>
        </div>

        <!-- DASHBOARD SCREEN -->
        <div id="dashboard" class="hidden space-y-6 animate-fade-in">

            <!-- Header -->
            <div class="flex items-center justify-between pb-4 border-b border-white/5">
                <div>
                    <h2 class="font-bold text-lg text-white">B·∫£ng ƒêi·ªÅu Khi·ªÉn Admin</h2>
                    <p class="text-xs text-gray-400">Qu·∫£n l√Ω Credit & Voucher Code</p>
                </div>
                <div class="text-right">
                    <button onclick="logout()" class="px-3 py-1 bg-red-500/10 hover:bg-red-500/20 rounded-lg border border-red-500/20 text-xs font-bold text-red-400">
                        ƒêƒÉng Xu·∫•t
                    </button>
                </div>
            </div>

            <!-- MAIN GRID -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- C·ªòT 1: QU·∫¢N L√ù KH√ÅCH H√ÄNG (S·ª¨A TR·ª∞C TI·∫æP ID) -->
                <div class="space-y-4">
                    <div class="flex items-center gap-2 text-sm font-semibold text-blue-400 uppercase tracking-wide bg-blue-500/10 p-2 rounded-lg border border-blue-500/20">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                        1. S·ª¨A CREDIT TR·ª∞C TI·∫æP (C·∫¶N NH·∫¨P ID)
                    </div>

                    <div class="card-section p-6 rounded-2xl glass space-y-6 h-full relative border-t-4 border-t-blue-500">
                        
                        <!-- B∆Ø·ªöC 1: NH·∫¨P ID -->
                        <div class="space-y-2">
                            <label class="text-[10px] text-blue-300 font-bold uppercase tracking-wider flex items-center gap-1">
                                <span class="bg-blue-500 text-white w-4 h-4 rounded-full flex items-center justify-center text-[9px]">1</span> 
                                Nh·∫≠p ID Kh√°ch H√†ng (User Key)
                            </label>
                            <div class="flex gap-2">
                                <input id="userKey" class="pro-input flex-1 px-4 py-3 rounded-xl text-xs font-mono text-yellow-300 font-bold border-yellow-500/30 focus:border-yellow-500" placeholder="V√≠ d·ª•: ID-V0HE9F">
                                <button onclick="searchUserKey()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-xl text-white font-bold transition-colors shadow-lg shadow-blue-500/20 whitespace-nowrap text-xs">
                                    T√åM / T·∫†O M·ªöI
                                </button>
                                <button onclick="createUserKey()" class="px-3 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-gray-400 transition-colors" title="T·∫°o ID ng·∫´u nhi√™n">
                                    +
                                </button>
                            </div>
                            <p id="searchMsg" class="text-[10px] h-4 text-blue-400 pl-1 italic flex items-center gap-1"></p>
                        </div>

                        <!-- B∆Ø·ªöC 2: ƒêI·ªÄU CH·ªàNH CREDIT -->
                        <div class="space-y-2 pt-4 border-t border-white/10">
                            <label class="text-[10px] text-gray-400 font-bold uppercase tracking-wider flex items-center gap-1">
                                <span class="bg-gray-600 text-white w-4 h-4 rounded-full flex items-center justify-center text-[9px]">2</span> 
                                ƒêi·ªÅu ch·ªânh s·ªë d∆∞ (C·ªông / Tr·ª´)
                            </label>
                            
                            <div class="relative">
                                <input id="manualCredit" type="number" class="pro-input w-full px-4 py-3 rounded-xl text-sm font-mono text-white font-bold pl-12 bg-black/20" placeholder="0">
                                <span class="absolute left-4 top-3.5 text-gray-500 font-bold text-xs">CR:</span>
                            </div>
                            
                            <!-- Quick Adjust Buttons -->
                            <div class="grid grid-cols-4 gap-2 mt-2">
                                <button onclick="quickAdjust(-100)" class="py-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-[10px] font-bold text-red-400 border border-red-500/20 transition-all active:scale-95">-100 (TR·ª™)</button>
                                <button onclick="quickAdjust(-50)" class="py-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-[10px] font-bold text-red-400 border border-red-500/20 transition-all active:scale-95">-50</button>
                                <button onclick="quickAdjust(50)" class="py-2 rounded-lg bg-green-500/10 hover:bg-green-500/20 text-[10px] font-bold text-green-400 border border-green-500/20 transition-all active:scale-95">+50</button>
                                <button onclick="quickAdjust(100)" class="py-2 rounded-lg bg-green-500/10 hover:bg-green-500/20 text-[10px] font-bold text-green-400 border border-green-500/20 transition-all active:scale-95">+100 (C·ªòNG)</button>
                            </div>
                        </div>

                        <!-- C·∫§U H√åNH KH√ÅC (·∫®N B·ªöT CHO G·ªåN) -->
                        <div class="space-y-2 pt-2">
                            <label class="text-[9px] text-gray-500 font-bold uppercase">C·∫•u h√¨nh API (T√πy ch·ªçn)</label>
                            <div class="grid grid-cols-2 gap-2">
                                <select id="provider" class="pro-input px-2 py-2 rounded-lg text-[10px] font-mono text-gray-400 cursor-pointer">
                                    <option value="gemini">Google Gemini</option>
                                    <option value="comet">Comet AI</option>
                                </select>
                                <input id="geminiKey" class="pro-input px-2 py-2 rounded-lg text-[10px] font-mono text-gray-400" placeholder="API Key...">
                                <input id="cometKey" type="hidden">
                            </div>
                        </div>

                        <!-- B∆Ø·ªöC 3: L∆ØU -->
                        <div class="pt-2">
                             <p id="saveStatus" class="text-center text-xs font-medium min-h-[16px] mb-2"></p>
                             <button onclick="saveUser()" class="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 rounded-xl font-bold text-white shadow-lg active:scale-[0.98] transition-all text-xs flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                                L∆ØU THAY ƒê·ªîI CHO ID TR√äN
                            </button>
                        </div>
                    </div>
                </div>

                <!-- C·ªòT 2: T·∫†O M√É VOUCHER (ƒê·ªòC L·∫¨P) -->
                <div class="space-y-4">
                     <div class="flex items-center gap-2 text-sm font-semibold text-purple-400 uppercase tracking-wide bg-purple-500/10 p-2 rounded-lg border border-purple-500/20">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path></svg>
                        2. T·∫†O M√É CODE (ƒê·ªÇ G·ª¨I CHO KH√ÅCH)
                    </div>

                    <div class="card-section p-6 rounded-2xl glass space-y-6 border-t-4 border-t-purple-500 bg-white/[0.02] relative">
                        <div class="absolute top-2 right-2 px-2 py-0.5 rounded bg-purple-500/10 border border-purple-500/20 text-[9px] text-purple-400 font-bold">Kh√¥ng C·∫ßn ID Kh√°ch</div>

                        <!-- 1. M·ªÜNH GI√Å C·ªòNG (+) -->
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider block mb-2">Ch·ªçn M·ªánh Gi√° Code</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="setAmount(80)" class="py-3 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 text-xs font-bold text-slate-300 transition-all hover:border-purple-500/50">80 CR (100K)</button>
                                <button onclick="setAmount(200)" class="py-3 rounded-xl bg-purple-600/20 hover:bg-purple-600/30 border border-purple-500/50 text-xs font-bold text-purple-200 transition-all">200 CR (200K)</button>
                                <button onclick="setAmount(500)" class="py-3 rounded-xl bg-blue-600/10 hover:bg-blue-600/20 border border-blue-500/30 text-xs font-bold text-blue-200 transition-all">500 CR (500K)</button>
                            </div>
                        </div>

                        <!-- √î nh·∫≠p m·ªánh gi√° t√πy ch·ªânh (C·ªôt 2) -->
                        <div class="relative pt-4 border-t border-white/5">
                            <label class="text-[10px] font-bold text-gray-500 uppercase block mb-2">Ho·∫∑c Nh·∫≠p S·ªë T√πy √ù (C√≥ th·ªÉ nh·∫≠p s·ªë √¢m ƒë·ªÉ tr·ª´)</label>
                            <input id="customAmount" type="number" placeholder="V√≠ d·ª•: 1000 ho·∫∑c -100" 
                                class="pro-input w-full px-4 py-3 rounded-xl font-mono text-sm border-2 focus:border-purple-500 transition-colors">
                            <span class="absolute right-4 top-11 text-xs text-gray-500 font-bold">CREDITS</span>
                        </div>

                        <button onclick="generateCode()" 
                            class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 rounded-xl font-bold text-white shadow-lg active:scale-[0.98] transition-all flex items-center justify-center gap-2 text-xs">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                            T·∫†O M√É CODE NGAY
                        </button>

                        <!-- K·∫æT QU·∫¢ V√Ä X√ÅC NH·∫¨N M·ªÜNH GI√Å -->
                        <div id="resultBox" class="hidden animate-fade-in pt-4 border-t border-white/10">
                            <label class="text-[10px] font-bold text-green-400 uppercase tracking-wider ml-1">M√£ Code V·ª´a T·∫°o:</label>
                            <div class="relative mt-2 group">
                                <input id="generatedCode" readonly 
                                    class="w-full bg-black/50 border border-green-500/50 rounded-xl py-4 px-4 text-center font-mono text-sm font-bold text-white tracking-widest cursor-pointer hover:bg-green-500/10 transition-colors shadow-[0_0_15px_rgba(34,197,94,0.1)]"
                                    onclick="copyCode()">
                                <div class="absolute right-3 top-1/2 -translate-y-1/2 px-2 py-1 bg-green-500 rounded text-[9px] font-bold text-black pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity">COPY</div>
                            </div>
                            <p id="copyStatus" class="text-center text-[10px] text-green-400 mt-1 h-3"></p>
                            <!-- D√íNG X√ÅC NH·∫¨N QUAN TR·ªåNG -->
                            <p id="codeValueConfirm" class="text-center text-[11px] text-yellow-300 font-mono font-bold mt-2 bg-yellow-500/10 py-2 rounded-lg border border-yellow-500/20"></p>
                        </div>

                        <!-- L·ªãch s·ª≠ -->
                         <div class="pt-2">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-[10px] font-bold text-gray-500 uppercase">L·ªãch s·ª≠ t·∫°o code</label>
                                <button onclick="clearHistory()" class="text-[9px] text-red-400 hover:text-red-300">X√≥a</button>
                            </div>
                            <div id="historyList" class="flex-1 overflow-y-auto space-y-1.5 pr-1 custom-scrollbar max-h-[120px]"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
// ===== ADMIN CONFIG =====
const ADMIN_PASS = "admin123";

// ===== SECURITY =====
const Sec = {
    key: "V35_SEC",
    enc(t) { return btoa([...t].map((c, i) => String.fromCharCode(c.charCodeAt(0) ^ this.key.charCodeAt(i % this.key.length))).join("")) },
    dec(t) { try { return [...atob(t)].map((c, i) => String.fromCharCode(c.charCodeAt(0) ^ this.key.charCodeAt(i % this.key.length))).join("") } catch (e) { return null; } }
};

// ===== DOM ELEMENTS =====
const els = {
    loginBox: document.getElementById('loginBox'),
    dashboard: document.getElementById('dashboard'),
    adminPass: document.getElementById('adminPass'),
    loginStatus: document.getElementById('loginStatus'),
    // API Config Elements (Col 1)
    userKey: document.getElementById('userKey'),
    searchMsg: document.getElementById('searchMsg'), 
    provider: document.getElementById('provider'),
    geminiKey: document.getElementById('geminiKey'),
    cometKey: document.getElementById('cometKey'),
    manualCredit: document.getElementById('manualCredit'),
    saveStatus: document.getElementById('saveStatus'),
    // Voucher Elements (Col 2)
    customAmount: document.getElementById('customAmount'),
    resultBox: document.getElementById('resultBox'),
    generatedCode: document.getElementById('generatedCode'),
    copyStatus: document.getElementById('copyStatus'),
    codeValueConfirm: document.getElementById('codeValueConfirm'), // New element
    historyList: document.getElementById('historyList')
};

// ===== LOGIN LOGIC =====
function adminLogin() {
    if (els.adminPass.value.trim() === ADMIN_PASS) {
        sessionStorage.setItem("v35_admin_logged", "true");
        showDash();
    } else {
        els.loginStatus.innerText = "Sai m·∫≠t kh·∫©u!";
        setTimeout(() => els.loginStatus.innerText = "", 2000);
    }
}

function showDash() {
    els.loginBox.style.display = "none";
    els.dashboard.classList.remove("hidden");
    loadActiveUser();
    renderHistory();
}

if (sessionStorage.getItem("v35_admin_logged") === "true") showDash();

function logout() {
    sessionStorage.removeItem("v35_admin_logged");
    location.reload();
}

// ===== CONFIG LOGIC (COL 1: TR·ª∞C TI·∫æP ID) =====

function createUserKey() {
    els.userKey.value = "V35-USER-" + Math.random().toString(36).substr(2, 8).toUpperCase();
    searchUserKey(); 
}

function searchUserKey() {
    const id = els.userKey.value.trim();
    if(!id) {
        els.searchMsg.innerText = "Vui l√≤ng nh·∫≠p ID ƒë·ªÉ t√¨m.";
        return;
    }

    // Reset inputs first to avoid confusion
    els.geminiKey.value = "";
    els.cometKey.value = "";
    els.manualCredit.value = 0;
    els.saveStatus.innerText = "";

    const storageKey = "v35_user_" + id;
    const savedData = localStorage.getItem(storageKey);

    if (savedData) {
        try {
            const data = JSON.parse(Sec.dec(savedData));
            if(data) {
                els.geminiKey.value = data.geminiKey || "";
                els.cometKey.value = data.cometKey || "";
                els.provider.value = data.provider || "gemini";
                els.manualCredit.value = data.credit || 0;
                els.searchMsg.innerHTML = `<span class="text-green-400 font-bold">‚úì ƒê√£ t·∫£i: Credit hi·ªán t·∫°i l√† ${data.credit || 0}</span>`;
            }
        } catch(e) { 
            console.error(e);
            els.searchMsg.innerText = "L·ªói ƒë·ªçc d·ªØ li·ªáu.";
        }
    } else {
        // ID m·ªõi ch∆∞a c√≥ tr√™n m√°y Admin n√†y.
        // Hi·ªÉn th·ªã th√¥ng b√°o th√¢n thi·ªán h∆°n ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt c√≥ th·ªÉ t·∫°o m·ªõi.
        els.searchMsg.innerHTML = '<span class="text-blue-400 font-bold">üÜï ID M·ªõi. Nh·∫≠p Credit v√† b·∫•m L∆ØU ƒë·ªÉ t·∫°o d·ªØ li·ªáu.</span>';
        els.manualCredit.value = 0; // ƒê·∫∑t v·ªÅ 0 ƒë·ªÉ s·∫µn s√†ng nh·∫≠p
    }
}

function loadActiveUser() {
    const savedData = localStorage.getItem("v35_active_user");
    if(savedData) {
        try {
            const data = JSON.parse(Sec.dec(savedData));
            if(data && data.userKey) {
                els.userKey.value = data.userKey;
                searchUserKey(); 
            }
        } catch(e) {}
    }
}

function quickAdjust(amount) {
    let currentVal = parseInt(els.manualCredit.value) || 0;
    let newVal = currentVal + amount;
    if(newVal < 0) newVal = 0; 
    els.manualCredit.value = newVal;
    
    // Highlight animation
    els.manualCredit.classList.add('bg-blue-500/20', 'text-yellow-300');
    setTimeout(() => els.manualCredit.classList.remove('bg-blue-500/20', 'text-yellow-300'), 300);
}

function saveUser() {
    const targetId = els.userKey.value.trim();
    if (!targetId) {
        els.saveStatus.innerHTML = "<span class='text-red-400 font-bold'>‚ùå L·ªói: Ch∆∞a nh·∫≠p ID Kh√°ch H√†ng (B∆∞·ªõc 1)</span>";
        return;
    }

    const data = {
        deviceId: "ADMIN-DEVICE", 
        userKey: targetId,
        geminiKey: els.geminiKey.value,
        cometKey: els.cometKey.value,
        provider: els.provider.value,
        credit: Number(els.manualCredit.value || 0),
        updatedAt: new Date().toISOString()
    };
    
    const encryptedData = Sec.enc(JSON.stringify(data));
    localStorage.setItem("v35_user_" + targetId, encryptedData);
    localStorage.setItem("v35_active_user", encryptedData);

    els.saveStatus.innerHTML = "<span class='text-green-400 font-bold'>‚úÖ TH√ÄNH C√îNG: ƒê√£ l∆∞u " + data.credit + " Credit cho ID " + targetId + "</span>";
    els.searchMsg.innerText = "";
    
    // Clear status after 3s
    setTimeout(() => els.saveStatus.innerHTML = "", 4000);
}

// ===== VOUCHER LOGIC (COL 2: T·∫†O CODE) =====
function setAmount(val) { 
    els.customAmount.value = val;
    // Highlight effect
    const colorClass = val < 0 ? 'border-red-500' : 'border-purple-500';
    const bgClass = val < 0 ? 'bg-red-500/10' : 'bg-purple-500/10';
    
    els.customAmount.classList.remove('border-purple-500', 'bg-purple-500/10', 'border-red-500', 'bg-red-500/10');
    els.customAmount.classList.add(colorClass, bgClass);
    
    setTimeout(() => els.customAmount.classList.remove(colorClass, bgClass), 300);
}

function generateCode() {
    const amount = parseInt(els.customAmount.value);
    if (!amount || amount === 0) return alert("Vui l√≤ng ch·ªçn ho·∫∑c nh·∫≠p s·ªë Credit ·ªü C·ªôt 2!");

    const prefix = "V35";
    const creditPart = amount.toString();
    const hashPart = Math.random().toString(36).substring(2, 6).toUpperCase(); 
    const randPart = Math.random().toString(36).substring(2, 6).toUpperCase(); 
    const timePart = Date.now().toString().slice(-4); 
    const finalCode = `${prefix}-${creditPart}-${hashPart}-${randPart}-${timePart}`;

    els.resultBox.classList.remove("hidden");
    els.generatedCode.value = finalCode;
    els.generatedCode.classList.remove('new-code');
    void els.generatedCode.offsetWidth;
    els.generatedCode.classList.add('new-code');

    // HI·ªÇN TH·ªä X√ÅC NH·∫¨N M·ªÜNH GI√Å (QUAN TR·ªåNG)
    const typeText = amount < 0 ? "‚ö†Ô∏è L∆ØU √ù: CODE TR·ª™ TI·ªÄN (THU H·ªíI)" : "‚úÖ CODE N·∫†P TI·ªÄN";
    const colorClass = amount < 0 ? "text-red-400 bg-red-500/10 border-red-500/20" : "text-yellow-300 bg-yellow-500/10 border-yellow-500/20";
    
    els.codeValueConfirm.className = `text-center text-[11px] font-mono font-bold mt-2 py-2 rounded-lg border ${colorClass}`;
    els.codeValueConfirm.innerText = `${typeText}: ${amount} CREDITS`;

    saveToHistory(finalCode, amount);
}

function copyCode() {
    const code = els.generatedCode.value;
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(code).then(onCopySuccess).catch(() => useFallbackCopy(code));
    } else {
        useFallbackCopy(code);
    }
}
function useFallbackCopy(code) {
    els.generatedCode.select();
    document.execCommand('copy');
    onCopySuccess();
}
function onCopySuccess() {
    els.copyStatus.innerText = "ƒê√£ copy!";
    setTimeout(() => els.copyStatus.innerText = "", 2000);
}

function saveToHistory(code, amount) {
    let history = JSON.parse(localStorage.getItem('v35_code_history') || '[]');
    history.unshift({ code, amount, time: new Date().toLocaleTimeString('vi-VN') });
    if(history.length > 20) history.pop();
    localStorage.setItem('v35_code_history', JSON.stringify(history));
    renderHistory();
}

function renderHistory() {
    let history = JSON.parse(localStorage.getItem('v35_code_history') || '[]');
    els.historyList.innerHTML = history.length ? history.map(item => `
        <div class="flex items-center justify-between p-2 rounded bg-white/5 border border-white/5 hover:bg-white/10 transition-colors group">
            <div class="text-[10px] text-gray-400">${item.time}</div>
            <div class="text-[10px] font-mono font-bold ${item.amount < 0 ? 'text-red-300' : 'text-purple-300'} select-all">${item.code}</div>
            <div class="text-[10px] font-bold ${item.amount < 0 ? 'text-red-400' : 'text-yellow-400'}">${item.amount > 0 ? '+' : ''}${item.amount}</div>
        </div>
    `).join('') : '<div class="text-center text-gray-600 text-[10px] py-4">Tr·ªëng</div>';
}
function clearHistory() {
    if(confirm("X√≥a l·ªãch s·ª≠?")) { localStorage.removeItem('v35_code_history'); renderHistory(); }
}

els.adminPass.addEventListener("keypress", function(e) { if (e.key === "Enter") adminLogin(); });

</script>
</body>
</html>