<!DOCTYPE html>
<html lang="vi" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V35 ADMIN SYSTEM - DEPLOY CENTER</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: {
                        glass: { border: 'rgba(255, 255, 255, 0.08)' }
                    },
                    animation: { 'fade-in': 'fadeIn 0.5s ease-out forwards', 'slide-up': 'slideUp 0.4s ease-out forwards' },
                    keyframes: { fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }, slideUp: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #09090b;
            background-image: radial-gradient(at 0% 0%, rgba(56, 189, 248, 0.1) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(236, 72, 153, 0.1) 0px, transparent 50%);
            background-attachment: fixed; color: #e4e4e7;
        }
        .glass-card { background: rgba(18, 18, 23, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2); }
        .input-field { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.2s ease; }
        .input-field:focus { border-color: #8b5cf6; box-shadow: 0 0 0 1px #8b5cf6; outline: none; }
        .btn-action:active { transform: scale(0.98); }
        .deploy-box { background: repeating-linear-gradient(45deg, rgba(0,0,0,0.2), rgba(0,0,0,0.2) 10px, rgba(0,0,0,0.3) 10px, rgba(0,0,0,0.3) 20px); }
        ::-webkit-scrollbar { width: 4px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4 sm:p-6">

    <!-- LOGIN -->
    <div id="loginBox" class="w-full max-w-sm glass-card rounded-2xl p-8 animate-fade-in text-center relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
        <div class="mb-8">
            <h1 class="text-2xl font-bold tracking-tight text-white">V35 ADMIN</h1>
            <p class="text-xs text-gray-500 mt-1 uppercase tracking-widest">System Control Center</p>
        </div>
        <div class="space-y-4">
            <input id="adminPass" type="password" placeholder="Mật khẩu Admin" class="input-field w-full px-4 py-3 rounded-xl text-center text-sm font-mono tracking-widest">
            <button onclick="adminLogin()" class="btn-action w-full py-3 bg-white text-black font-bold rounded-xl text-sm hover:bg-gray-200">LOGIN</button>
            <p id="loginStatus" class="text-xs text-red-400 font-medium h-4"></p>
        </div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="hidden w-full max-w-6xl animate-slide-up pb-10">
        
        <!-- Header -->
        <div class="flex flex-col md:flex-row items-center justify-between mb-6 gap-4">
            <div>
                <h2 class="font-bold text-xl text-white">Dashboard Quản Trị</h2>
                <p class="text-xs text-gray-400">Phiên bản V35.80 (Static Web Optimized)</p>
            </div>
            <div class="flex items-center gap-3">
                 <div class="text-right">
                    <p class="text-[9px] text-gray-500 uppercase font-bold">DEVICE ID</p>
                    <p id="myDeviceId" class="text-xs font-mono text-blue-400 font-bold">LOADING...</p>
                </div>
                <button onclick="logout()" class="px-4 py-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 text-xs font-bold border border-red-500/20">Thoát</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- COT 1: CẤU HÌNH & DEPLOY -->
            <div class="space-y-6">
                <!-- Cấu hình API -->
                <div class="glass-card rounded-2xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-3 opacity-10"><svg class="w-24 h-24 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg></div>
                    <h3 class="text-sm font-bold text-blue-400 uppercase tracking-widest mb-4 border-b border-white/5 pb-2">1. Cấu Hình API (Gốc)</h3>
                    
                    <div class="space-y-4 relative z-10">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-gray-500">LOẠI API</label>
                            <select id="provider" class="input-field w-full px-3 py-2 rounded-lg text-xs font-bold text-white bg-gray-900">
                                <option value="gemini">Google Gemini AI (Khuyên dùng)</option>
                                <option value="comet">Comet Service</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-gray-500">API KEY (Dán Key vào đây)</label>
                            <input id="geminiKey" class="input-field w-full px-3 py-2 rounded-lg text-xs font-mono text-yellow-400" placeholder="AIzaSy...">
                        </div>
                        <div class="flex gap-2">
                             <button onclick="saveLocal()" class="flex-1 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs font-bold text-gray-300 border border-white/10">Lưu Tạm (Local)</button>
                             <button onclick="loadLocal()" class="flex-1 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs font-bold text-gray-300 border border-white/10">Tải Lại</button>
                        </div>
                    </div>
                </div>

                <!-- DEPLOY ZONE (QUAN TRỌNG) -->
                <div class="glass-card rounded-2xl p-6 deploy-box border-blue-500/30">
                    <h3 class="text-sm font-bold text-green-400 uppercase tracking-widest mb-2 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        2. XUẤT MÃ NHÚNG (CHO WEB TĨNH)
                    </h3>
                    <p class="text-[10px] text-gray-400 mb-4">Để web chạy được trên mọi máy (Online), bạn phải tạo mã nhúng này và dán vào file index.html.</p>

                    <button onclick="generateDeployCode()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold text-xs rounded-xl shadow-lg shadow-blue-500/20 transition-all active:scale-95">
                        TẠO MÃ CẤU HÌNH & COPY
                    </button>

                    <div id="deployResult" class="hidden mt-4 space-y-2">
                        <textarea id="deployCodeOutput" readonly class="w-full h-24 bg-black/50 border border-green-500/30 rounded-lg p-2 text-[10px] font-mono text-green-400 break-all select-all focus:outline-none"></textarea>
                        <div class="text-[10px] text-yellow-400 bg-yellow-400/10 p-2 rounded border border-yellow-400/20">
                            <strong>⚠️ HƯỚNG DẪN:</strong> <br>
                            1. Copy toàn bộ đoạn mã trên.<br>
                            2. Mở file <code>index.html</code>.<br>
                            3. Tìm dòng: <code>const DEFAULT_ENCRYPTED_CONFIG = "";</code><br>
                            4. Dán vào giữa hai dấu ngoặc kép.
                        </div>
                    </div>
                </div>
            </div>

            <!-- COT 2: QUẢN LÝ NGƯỜI DÙNG & CODE -->
            <div class="glass-card rounded-2xl p-6 flex flex-col h-full">
                <h3 class="text-sm font-bold text-purple-400 uppercase tracking-widest mb-4 border-b border-white/5 pb-2">3. Quản Lý & Tạo Code</h3>

                <div class="space-y-4 flex-1">
                     <!-- User Lock -->
                     <div class="bg-white/5 p-3 rounded-xl border border-white/5 space-y-2">
                        <label class="text-[10px] font-bold text-gray-500">KHÓA MÁY KHÁCH (ID-XXXXX)</label>
                        <div class="flex gap-2">
                            <input id="targetMachineId" class="input-field flex-1 px-3 py-2 rounded-lg text-xs font-mono text-white" placeholder="ID Máy khách...">
                            <button onclick="saveUserConfig()" class="px-3 py-2 bg-purple-600/20 text-purple-400 border border-purple-500/30 rounded-lg text-[10px] font-bold hover:bg-purple-600/30">LƯU ID</button>
                        </div>
                        <p class="text-[9px] text-gray-500 italic">* ID này sẽ được gắn vào Code nạp tiền bên dưới.</p>
                     </div>

                     <!-- Code Gen -->
                     <div class="space-y-2 pt-2">
                        <label class="text-[10px] font-bold text-gray-500">TẠO VOUCHER NẠP TIỀN</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setAmount(100)" class="py-2 rounded bg-white/5 hover:bg-purple-500/20 border border-white/5 text-[10px] font-bold text-gray-300">100 CR</button>
                            <button onclick="setAmount(200)" class="py-2 rounded bg-white/5 hover:bg-purple-500/20 border border-white/5 text-[10px] font-bold text-gray-300">200 CR</button>
                            <button onclick="setAmount(500)" class="py-2 rounded bg-white/5 hover:bg-purple-500/20 border border-white/5 text-[10px] font-bold text-gray-300">500 CR</button>
                        </div>
                        <div class="flex gap-2">
                             <input id="customAmount" type="number" class="input-field w-20 px-2 py-2 rounded-lg text-xs text-center" placeholder="SL">
                             <button onclick="generateCode()" class="flex-1 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg text-xs font-bold text-white shadow-lg shadow-purple-500/20">TẠO MÃ</button>
                        </div>
                     </div>

                     <!-- Result -->
                     <div id="codeResult" class="hidden bg-black/40 border border-green-500/20 rounded-xl p-3 text-center animate-fade-in">
                         <p class="text-[9px] text-gray-500 uppercase font-bold mb-1">Mã Nạp Tiền (Đã Copy)</p>
                         <p id="finalCode" class="text-sm font-mono font-bold text-green-400 tracking-widest select-all"></p>
                         <p id="codeDetail" class="text-[9px] text-gray-400 mt-1"></p>
                     </div>
                </div>
            </div>

        </div>
    </div>

<script>
// === LOGIC CỐT LÕI ===
const ADMIN_PASS = "admin123";
// Key mã hóa (Phải khớp với Index)
const Sec = {
    key: "V35_SEC_V2",
    enc(t){ return btoa([...encodeURIComponent(t)].map((c,i) => String.fromCharCode(c.charCodeAt(0) ^ this.key.charCodeAt(i % this.key.length))).join("")) },
    dec(t){ try { return decodeURIComponent([...atob(t)].map((c,i) => String.fromCharCode(c.charCodeAt(0) ^ this.key.charCodeAt(i % this.key.length))).join("")) } catch(e){ return null; } }
};

const els = {
    loginBox: document.getElementById('loginBox'),
    dashboard: document.getElementById('dashboard'),
    adminPass: document.getElementById('adminPass'),
    loginStatus: document.getElementById('loginStatus'),
    provider: document.getElementById('provider'),
    geminiKey: document.getElementById('geminiKey'),
    targetMachineId: document.getElementById('targetMachineId'),
    customAmount: document.getElementById('customAmount'),
    codeResult: document.getElementById('codeResult'),
    finalCode: document.getElementById('finalCode'),
    codeDetail: document.getElementById('codeDetail'),
    deployResult: document.getElementById('deployResult'),
    deployCodeOutput: document.getElementById('deployCodeOutput'),
    myDeviceId: document.getElementById('myDeviceId')
};

// 1. LOGIN
function adminLogin() {
    if(els.adminPass.value.trim() === ADMIN_PASS) {
        els.loginBox.style.display = 'none';
        els.dashboard.classList.remove('hidden');
        loadLocal();
        els.myDeviceId.innerText = "ADMIN-SESSION";
    } else {
        els.loginStatus.innerText = "Sai mật khẩu!";
    }
}
els.adminPass.addEventListener("keypress", (e) => { if (e.key === "Enter") adminLogin(); });

// 2. SAVE/LOAD LOCAL (Chỉ để nhớ trên máy Admin, ko phải Deploy)
function saveLocal() {
    const data = { p: els.provider.value, k: els.geminiKey.value, t: els.targetMachineId.value };
    localStorage.setItem('v35_admin_draft', JSON.stringify(data));
    alert("Đã lưu nháp trên máy này.");
}
function loadLocal() {
    const raw = localStorage.getItem('v35_admin_draft');
    if(raw) {
        const d = JSON.parse(raw);
        if(d.p) els.provider.value = d.p;
        if(d.k) els.geminiKey.value = d.k;
        if(d.t) els.targetMachineId.value = d.t;
    }
}

// 3. DEPLOY (QUAN TRỌNG NHẤT CHO WEB TĨNH)
function generateDeployCode() {
    const apiKey = els.geminiKey.value.trim();
    const provider = els.provider.value;
    
    if(!apiKey) return alert("Chưa nhập API Key!");

    const config = {
        apiKey: apiKey,
        provider: provider,
        baseUrl: "https://generativelanguage.googleapis.com",
        generatedAt: Date.now()
    };

    // Mã hóa thành chuỗi an toàn
    const encryptedString = Sec.enc(JSON.stringify(config));
    
    // Hiển thị
    els.deployResult.classList.remove('hidden');
    els.deployCodeOutput.value = encryptedString;
    
    // Tự động copy
    els.deployCodeOutput.select();
    document.execCommand('copy');
    alert("ĐÃ COPY MÃ NHÚNG!\n\nBây giờ hãy mở file index.html và dán vào biến DEFAULT_ENCRYPTED_CONFIG.");
}

// 4. GENERATE VOUCHER (CODE NẠP TIỀN)
function setAmount(n) { els.customAmount.value = n; }
function generateCode() {
    const amt = parseInt(els.customAmount.value);
    const machine = els.targetMachineId.value.trim();
    
    if(!amt) return alert("Chưa nhập số tiền!");
    if(!machine) return alert("CẢNH BÁO: Chưa nhập ID Máy khách (Code này sẽ không khóa máy!)");

    // Format: AMOUNT|MACHINE_ID|RANDOM
    const rawPayload = `${amt}|${machine}|${Math.random().toString(36).substr(2,5)}`;
    const token = Sec.enc(rawPayload);
    const code = `V35-${token}`;

    els.codeResult.classList.remove('hidden');
    els.finalCode.innerText = code;
    els.codeDetail.innerText = `Nạp ${amt} CR cho máy ${machine || 'ALL'}`;
    
    // Copy Code
    navigator.clipboard.writeText(code);
}
</script>
</body>
</html>